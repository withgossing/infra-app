# Service Discovery - Consul

HashiCorp Consul κΈ°λ°μ μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ λ° μ„¤μ • κ΄€λ¦¬ μ‹μ¤ν…μ…λ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥

- **μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬**: λ™μ  μ„λΉ„μ¤ λ“±λ΅ λ° λ°κ²¬
- **ν—¬μ¤μ²΄ν¬**: μ„λΉ„μ¤ μƒνƒ λ¨λ‹ν„°λ§ λ° μλ™ μ¥μ• μ΅°μΉ
- **KV μ¤ν† μ–΄**: λ¶„μ‚° μ„¤μ • κ΄€λ¦¬
- **Service Mesh**: Consul Connectλ¥Ό ν†µν• μ„λΉ„μ¤ κ°„ λ³΄μ• ν†µμ‹ 
- **μ›Ή UI**: μ§κ΄€μ μΈ κ΄€λ¦¬ μΈν„°νμ΄μ¤
- **DNS μΈν„°νμ΄μ¤**: DNS κΈ°λ° μ„λΉ„μ¤ λ°κ²¬

## π μ ‘μ† μ •λ³΄

### Docker Compose ν™κ²½
- **Consul UI**: http://localhost:10500
- **Consul API**: http://localhost:10500/v1/
- **Consul DNS**: localhost:10600

### Kubernetes ν™κ²½
- **Consul UI**: http://consul-ui.consul.svc.cluster.local:8500
- **Consul API**: http://consul-server.consul.svc.cluster.local:8500/v1/

## π—οΈ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Consul-1      β”‚    β”‚   Consul-2      β”‚    β”‚   Consul-3      β”‚
β”‚   (Leader)      β”‚β—„β”€β”€β–Ίβ”‚   (Follower)    β”‚β—„β”€β”€β–Ίβ”‚   (Follower)    β”‚
β”‚                 β”‚    β”‚                 β”‚    β”‚                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
         β”‚                       β”‚                       β”‚
         β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                 β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚   Load Balancer β”‚
                    β”‚   (ν¬νΈ 10500)   β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π€ μ‹μ‘ν•κΈ°

### Docker Composeλ΅ μ‹¤ν–‰
```bash
cd /Users/gossing/WorkPlace/infra-app/service-discovery
docker-compose up -d
```

### Kubernetesλ΅ μ‹¤ν–‰
```bash
kubectl apply -f k8s/
```

## π“ μ„λΉ„μ¤ λ“±λ΅ μμ 

### REST APIλ¥Ό ν†µν• λ“±λ΅
```bash
curl -X PUT http://localhost:10500/v1/agent/service/register \
  -d '{
    "ID": "web-01",
    "Name": "web",
    "Tags": ["v1", "primary"],
    "Address": "192.168.1.100",
    "Port": 8080,
    "Check": {
      "HTTP": "http://192.168.1.100:8080/health",
      "Interval": "10s"
    }
  }'
```

### DNSλ¥Ό ν†µν• μ΅°ν
```bash
dig @localhost -p 10600 web.service.consul
```

## π”§ μ„¤μ • μµμ…

- **ν΄λ¬μ¤ν„° ν¬κΈ°**: 3κ° λ…Έλ“ (κ³ κ°€μ©μ„±)
- **λ°μ΄ν„° λ°±μ—…**: μλ™ μ¤λƒ…μƒ· κΈ°λ¥
- **λ³΄μ•**: TLS μ•”νΈν™” λ° ACL μ§€μ›
- **μ„±λ¥**: SSD μ¤ν† λ¦¬μ§€ κ¶μ¥

## π“ λ¨λ‹ν„°λ§

Consul λ©”νΈλ¦­μ€ Prometheus ν•μ‹μΌλ΅ λ…Έμ¶λ©λ‹λ‹¤:
- μ—”λ“ν¬μΈνΈ: http://localhost:10500/v1/agent/metrics?format=prometheus
